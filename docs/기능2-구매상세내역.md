# N-Split 구매 상세 내역 기능 명세서

## 개요
N-Split 투자 관리 서비스에서 특정 종목의 '구매 상세 내역'을 확인할 수 있는 화면이다.  
기존 대시보드에서 '구매 상세 내역' 버튼을 클릭하면, 팝업이 아닌 **새로운 창에서** 상세 정보를 제공한다.  
이 화면에서는 전략 생성 시 설정한 단계별 투자 계획이 실제 매수/매도 내역과 어떻게 반영되었는지를 확인할 수 있다.

---

## 1. 상단 요약 정보
해당 전략의 모든 단계에 대한 **종합적인 투자 현황**을 제공한다.  
- **전략 단계 개수**: 해당 전략이 몇 단계로 구성되었는지 표시 (예: `5단계`)  
- **총 투자 금액**: 전략 전체에서 설정된 총 투자 금액  
- **목표 수익률**: 전략 생성 시 설정된 목표 수익률  
- **매수 하락률**: 각 단계별 매수 가격 조정 비율  
- **현재 진행 상태**: 현재 진행 중인 단계 표시 (예: `3단계 진행 중`)  
- **평가 금액**: 현재 해당 전략에서 보유한 종목의 총 평가 금액  
- **매입 금액**: 총 매입 금액 (해당 전략에서 종목을 매수한 총 금액)  
- **보유 수량**: 현재 보유 중인 총 주식 수량  
- **수익률**: 총 수익률 (평가 금액과 매입 금액을 기준으로 계산)  
- **수익금**: 현재까지 발생한 총 수익금 (실현 손익 포함)  

---

## 2. 하단 단계별 상세 내역

### **2.1 진행 중인 단계**  
- 현재 진행 중인 투자 단계를 Stack 구조로 표시 (최신 단계가 가장 위)  
- 종료되지 않은 단계만 기본적으로 표시  

📌 **예시 (진행 중인 단계)**
```
🔹 단계 3 (진행 중)  
   - 설정 매수 비중: 20%  
   - 목표 수익률: 7%  
   - 예상 매수 가격: ₩195,391  
   - 실제 매입 금액: ₩1,300,000  
   - 보유 수량: 150주  
   - 현재 평가 금액: ₩1,500,000  
   - 현재 수익률: +15.3%  
   - 평가 손익: ₩200,000  

🔹 단계 2 (진행 중)  
   - 설정 매수 비중: 20%  
   - 목표 수익률: 7%  
   - 예상 매수 가격: ₩205,675  
   - 실제 매입 금액: ₩2,200,000  
   - 보유 수량: 100주  
   - 현재 평가 금액: ₩2,300,000  
   - 현재 수익률: +4.5%  
   - 평가 손익: ₩100,000  

🔹 단계 1 (진행 중)  
   - 설정 매수 비중: 20%  
   - 목표 수익률: 7%  
   - 예상 매수 가격: ₩216,500  
   - 실제 매입 금액: ₩1,000,000  
   - 보유 수량: 50주  
   - 현재 평가 금액: ₩1,200,000  
   - 현재 수익률: +20%  
   - 평가 손익: ₩200,000  
```

---

### **2.2 종료된 내역 (토글 버튼으로 확장 가능)**
- 종료된 단계는 기본적으로 숨김  
- 사용자가 필요할 때만 확인할 수 있도록 `"종료된 내역 보기 🔽"` 버튼 제공  
- 확장 시, 종료된 단계를 Stack 구조 순서대로 표시  
- 종료된 내역이 많아질 경우 `"종료된 내역 숨기기 🔼"` 버튼을 눌러 다시 접을 수 있음  

📌 **예시 (종료된 내역, 토글 활성화 시 표시)**  
```
📌 [🔽 종료된 내역 보기] (클릭 시 확장)

🔹 단계 3 (종료됨)  
   - 설정 매수 비중: 20%  
   - 목표 수익률: 7%  
   - 예상 매수 가격: ₩176,341  
   - 실제 매입 금액: ₩900,000  
   - 보유 수량: 50주  
   - 최종 매도 금액: ₩1,000,000  
   - 최종 수익률: +11.1%  
   - 최종 손익: ₩100,000  

🔹 단계 2 (종료됨)  
   - 설정 매수 비중: 20%  
   - 목표 수익률: 7%  
   - 예상 매수 가격: ₩185,622  
   - 실제 매입 금액: ₩750,000  
   - 보유 수량: 30주  
   - 최종 매도 금액: ₩800,000  
   - 최종 수익률: +6.7%  
   - 최종 손익: ₩50,000  

📌 [🔼 종료된 내역 숨기기] (클릭 시 숨김)
```

---

## 3. UI 요구사항  
✅ 진행 중인 단계와 종료된 단계를 **분리하여 표시**  
✅ 진행 중인 단계는 **기본적으로 보이도록 설정**  
✅ 종료된 단계는 **기본적으로 숨기되, 필요할 때 토글 버튼으로 열 수 있도록 구현**  
✅ **Stack 구조를 유지**하여 최신 단계가 가장 위에 표시됨  
✅ UI 요소 추가:
   - `"🔽 종료된 내역 보기"` 버튼 (기본 숨김 상태)  
   - `"🔼 종료된 내역 숨기기"` 버튼 (활성화 시 보이도록 설정)  

---

## 4. 최종 결론
📌 **기본적으로 진행 중인 단계와 종료된 단계를 분리**  
📌 **사용자가 종료된 내역을 보고 싶을 때 확장 가능 (토글 버튼 추가)**  
📌 **Stack 구조를 유지하되, UI에서 불필요한 정보는 기본적으로 숨김**  
📌 **실제 매수/매도 내역과 전략 설정 값을 함께 표시하여 비교 가능**  

🚀 **이 방식이면 현재 전략을 빠르게 확인하면서도, 필요할 때 투자 흐름을 분석할 수 있어 가독성이 좋을 것!**  
